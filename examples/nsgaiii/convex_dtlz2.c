#include "constraint.h"
#include <stdio.h>

#define NOBJ  3
#define DIM  12
#define K (DIM - NOBJ + 1)

static double g (double *x)
{
    int i;
    double s = 0;
    for (i=0; i<K; i++) {
        s += pow (x [i] - 0.5, 2);
    }
    return s;
}

static void f (double *x, double *y)
{
    int i, j;
    double gv = g (x + DIM - K);
    for (i=0; i<NOBJ; i++) {
        double p = 1;
        for (j=0; j<NOBJ-i-1; j++) {
            p *= cos (x [j] * M_PI / 2.0);
        }
        if (j < NOBJ-1) {
            p *= sin (x [j] * M_PI / 2.0);
        }
        y [i] = pow (p * (1 + gv), (i == NOBJ - 1) ? 2 : 4);
    }
}

struct multi_problem convex_dtlz2 =
{ .dimension      = DIM
, .nfunc          = NOBJ
, .nconstraint    = 0
, .lower          = (double []){ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
, .upper          = (double []){ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 }
, .popsize        = 0
, .generations    = 250
, .f              = f
, .name           = "Convex DTLZ2"
};

#ifdef DEBUG_EVAL
#include <stdio.h>
int main ()
{
    int i, j;
    static double xx [][DIM] =
        { { 6.691246e-09, 9.817440e-01, 4.729821e-01, 4.793032e-01
          , 5.178501e-01, 5.226634e-01, 4.957561e-01, 5.075001e-01
          , 5.026741e-01, 4.739887e-01, 5.055179e-01, 5.027443e-01
          }
        , { 9.998528e-01, 1.935470e-05, 4.705579e-01, 4.866187e-01
          , 5.191910e-01, 4.794531e-01, 4.856936e-01, 4.884540e-01
          , 4.004986e-01, 4.757958e-01, 4.232851e-01, 4.677805e-01
          }
        , { 1.257113e-06, 2.346399e-03, 3.125069e-01, 5.058267e-01
          , 5.123295e-01, 4.963675e-01, 4.872088e-01, 4.700797e-01
          , 4.707041e-01, 4.740843e-01, 5.080537e-01, 5.027483e-01
          }
        , { 1.173930e-02, 9.999996e-01, 4.729291e-01, 4.507752e-01
          , 5.178955e-01, 5.227561e-01, 4.958476e-01, 5.069914e-01
          , 5.082455e-01, 4.740209e-01, 5.058688e-01, 5.052922e-01
          }
        , { 9.998634e-01, 9.999996e-01, 4.306706e-01, 4.802241e-01
          , 5.178084e-01, 5.244982e-01, 4.961293e-01, 4.977133e-01
          , 4.732233e-01, 4.738540e-01, 5.056860e-01, 4.701948e-01
          }
        , { 9.998633e-01, 2.236934e-03, 3.126983e-01, 4.864973e-01
          , 5.122284e-01, 5.246349e-01, 4.856936e-01, 4.884362e-01
          , 4.657253e-01, 4.738118e-01, 4.217053e-01, 4.719564e-01
          }
        , { 7.552423e-01, 6.054027e-01, 4.703475e-01, 4.509988e-01
          , 5.175639e-01, 4.842538e-01, 5.140435e-01, 4.901777e-01
          , 5.082689e-01, 4.740209e-01, 5.058688e-01, 5.052886e-01
          }
        , { 4.063842e-01, 3.710658e-01, 5.089956e-01, 4.800728e-01
          , 5.187930e-01, 5.226404e-01, 4.828083e-01, 4.974299e-01
          , 4.707255e-01, 5.008406e-01, 5.075724e-01, 4.720265e-01
          }
        , { 2.576445e-01, 6.144199e-01, 5.303802e-01, 4.794296e-01
          , 5.187788e-01, 4.787976e-01, 4.956639e-01, 4.721828e-01
          , 4.857744e-01, 4.038473e-01, 5.062777e-01, 5.054687e-01
          }
        , { 7.398886e-02, 5.895295e-01, 4.706166e-01, 4.986712e-01
          , 5.185775e-01, 5.226656e-01, 4.956774e-01, 4.708941e-01
          , 5.032321e-01, 4.740202e-01, 5.088765e-01, 5.027451e-01
          }
        , { 2.007529e-01, 9.843096e-01, 4.603684e-01, 4.798482e-01
          , 5.187897e-01, 4.787851e-01, 5.155025e-01, 4.936920e-01
          , 4.683971e-01, 5.111035e-01, 5.058369e-01, 4.690449e-01
          }
        , { 6.058170e-01, 5.975830e-01, 4.865577e-01, 4.989078e-01
          , 5.187606e-01, 4.795489e-01, 4.956774e-01, 4.706270e-01
          , 5.027817e-01, 5.108989e-01, 5.075879e-01, 5.027731e-01
          }
        , { 3.704356e-01, 6.137862e-01, 5.271749e-01, 4.869456e-01
          , 5.178266e-01, 4.792746e-01, 4.957404e-01, 4.721828e-01
          , 4.857744e-01, 5.210932e-01, 5.076253e-01, 5.055916e-01
          }
        , { 8.728079e-01, 3.332626e-01, 4.708911e-01, 4.716024e-01
          , 4.909295e-01, 5.098468e-01, 4.958102e-01, 4.696421e-01
          , 4.867897e-01, 5.297717e-01, 5.075994e-01, 4.679909e-01
          }
        , { 8.716032e-01, 7.019043e-01, 4.696347e-01, 4.794691e-01
          , 4.909295e-01, 4.794325e-01, 5.153083e-01, 4.721851e-01
          , 4.868017e-01, 5.297717e-01, 5.075994e-01, 4.679909e-01
          }
        , { 4.062335e-02, 1.258150e-01, 4.806457e-01, 4.792609e-01
          , 5.187923e-01, 5.549266e-01, 4.956404e-01, 4.620271e-01
          , 5.022433e-01, 4.735781e-01, 5.054990e-01, 4.699146e-01
          }
        , { 3.361455e-01, 3.208891e-02, 5.021510e-01, 4.799232e-01
          , 5.525418e-01, 4.885149e-01, 4.872394e-01, 4.488086e-01
          , 5.420124e-01, 4.761392e-01, 5.104557e-01, 4.357588e-01
          }
        , { 4.644959e-01, 3.104583e-03, 4.692142e-01, 4.341210e-01
          , 5.233084e-01, 4.963682e-01, 4.856673e-01, 4.905222e-01
          , 4.949361e-01, 4.007290e-01, 5.979019e-01, 4.730147e-01
          }
        , { 1.841295e-01, 6.971521e-01, 6.363317e-01, 4.799527e-01
          , 5.178058e-01, 4.790805e-01, 5.154111e-01, 4.974037e-01
          , 5.172044e-01, 4.858516e-01, 5.065491e-01, 5.056172e-01
          }
        , { 3.155188e-01, 6.973021e-01, 4.870554e-01, 4.790302e-01
          , 4.907661e-01, 5.099903e-01, 4.950743e-01, 4.976855e-01
          , 5.005833e-01, 4.737116e-01, 5.067398e-01, 5.044926e-01
          }
        , { 1.333452e-01, 6.106761e-01, 6.363317e-01, 4.798363e-01
          , 5.177858e-01, 4.790805e-01, 4.955371e-01, 4.974037e-01
          , 5.059320e-01, 4.736685e-01, 5.062735e-01, 5.056167e-01
          }
        , { 2.692521e-02, 3.501505e-01, 5.089956e-01, 4.507930e-01
          , 5.187930e-01, 5.226404e-01, 5.139094e-01, 4.056386e-01
          , 5.070583e-01, 4.746912e-01, 5.075724e-01, 5.063203e-01
          }
        , { 2.588491e-01, 3.322543e-01, 6.382541e-01, 4.715629e-01
          , 5.178478e-01, 5.092120e-01, 4.960398e-01, 4.696397e-01
          , 4.857625e-01, 3.782797e-01, 5.065533e-01, 5.054692e-01
          }
        , { 6.968499e-01, 5.981653e-01, 4.616721e-01, 4.808057e-01
          , 5.187930e-01, 4.770134e-01, 4.828658e-01, 4.706261e-01
          , 4.706885e-01, 5.017716e-01, 5.075995e-01, 4.717681e-01
          }
        , { 6.968499e-01, 5.982575e-01, 4.610880e-01, 4.808439e-01
          , 5.187930e-01, 5.215457e-01, 4.828658e-01, 4.706261e-01
          , 4.706887e-01, 5.017604e-01, 5.075995e-01, 4.707934e-01
          }
        , { 6.132544e-01, 6.295876e-01, 5.332283e-01, 4.794601e-01
          , 5.120490e-01, 4.979814e-01, 4.956818e-01, 5.250227e-01
          , 4.854917e-01, 4.875029e-01, 5.087008e-01, 5.027451e-01
          }
        , { 3.194006e-01, 3.710658e-01, 5.089956e-01, 4.800728e-01
          , 5.187930e-01, 5.226404e-01, 4.828083e-01, 4.974477e-01
          , 4.037952e-01, 5.011151e-01, 5.066140e-01, 4.677866e-01
          }
        , { 1.926424e-01, 1.084207e-01, 4.603684e-01, 4.798482e-01
          , 5.187755e-01, 4.791215e-01, 5.140807e-01, 4.936919e-01
          , 4.683971e-01, 5.111470e-01, 5.075739e-01, 5.060325e-01
          }
        , { 1.334731e-01, 3.580713e-03, 5.950719e-01, 4.504887e-01
          , 5.177846e-01, 4.795302e-01, 4.868294e-01, 4.088465e-01
          , 5.062914e-01, 4.737834e-01, 4.311733e-01, 5.030406e-01
          }
        , { 4.644959e-01, 1.072930e-01, 4.696213e-01, 4.340369e-01
          , 5.191894e-01, 4.963470e-01, 4.856936e-01, 4.905222e-01
          , 4.697468e-01, 5.307276e-01, 4.235042e-01, 4.730147e-01
          }
        };
    double yy [NOBJ];
    size_t sz = sizeof (xx) / (sizeof (double) * DIM);
    for (i=0; i<sz; i++) {
        double s = 0;
        f (xx [i], yy);
        printf ("G: %e\n", g (xx [i] + DIM - K));
        for (j=0; j<NOBJ; j++) {
            printf ("F %d %e\n", j, yy [j]);
            s += yy [j];
        }
        printf ("\ns: %e\n", s);
    }
}
#endif /* DEBUG_EVAL */
